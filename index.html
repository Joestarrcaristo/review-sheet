<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Review Spreadsheet</title>
</head>
<body>

<h3>Review Spreadsheet</h3>

<input id="docName" placeholder="Enter case ID" />
<button id="createBtn" onclick="createDoc()">Create</button>

<p id="result"></p>

<script>
let loadingInterval;

async function createDoc() {
  const name = document.getElementById("docName").value.trim();
  const result = document.getElementById("result");
  const button = document.getElementById("createBtn");

  if (!name) {
    alert("Please enter case ID");
    return;
  }

  // Start loading animation with dots
  let dots = 0;
  result.textContent = "Creating document";
  loadingInterval = setInterval(() => {
    dots = (dots + 1) % 4; // cycles through 0..3
    result.textContent = "Creating document" + ".".repeat(dots);
  }, 500);

  button.disabled = true;

  try {
    await fetch("https://defaultd2d5a7da0ed94596840e63695c39f6.86.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/7a17b7557f414bc2a4a8ca64b8502b00/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=jr_DGykVYbpCUrgMJrt8NhyMVtmVd81AvV95vlWldL0", { 
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ filename: name })
    });

    const encodedName = encodeURIComponent(name);

    const url = `https://caristodiagnostics.sharepoint.com/Shared%20Documents%2FImage%20Analysis%2FIA%20-%20UK%2F%28PERP%29%20Plaque%20Escalation%20Review%20Process%2FCase%20Reviews/${encodedName}.xlsm?web=1`; 

    result.innerHTML = `<a href="${url}" target="_blank">Open spreadsheet</a>`;
  } catch (err) {
    result.textContent = "Error creating document";
    console.error(err);
  } finally {
    // Stop loading animation
    clearInterval(loadingInterval);
    button.disabled = false;
  }
}
</script>

</body>
</html>